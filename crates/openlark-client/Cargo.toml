[package]
name = "openlark-client"
version.workspace = true
edition.workspace = true
authors.workspace = true
license.workspace = true
description = "现代化飞书开放平台 Rust SDK - 简化客户端，支持功能驱动的模块化编译"

[dependencies]
# Core dependencies
openlark-core = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
async-trait = { workspace = true }
tokio = { workspace = true }
tracing = { workspace = true }
thiserror = { workspace = true }

# Additional dependencies for unified client
chrono = { workspace = true, features = ["serde"] }
uuid = { workspace = true, features = ["v4"] }

# WebSocket dependencies
tokio-tungstenite = { workspace = true, optional = true }
futures-util = { workspace = true, optional = true }
lark-websocket-protobuf = { workspace = true, optional = true }
url = { workspace = true, optional = true }
prost = { workspace = true, optional = true }
reqwest = { workspace = true, optional = true }
log = { workspace = true, optional = true }

# P0 Phase 1 业务模块依赖
openlark-auth = { workspace = true }  # 认证服务设为默认依赖
openlark-communication = { workspace = true, optional = true }
openlark-docs = { workspace = true, optional = true }
openlark-security = { workspace = true, optional = true }

# Phase 2+ 模块依赖（暂时只保留存在的）
openlark-hr = { workspace = true, optional = true }  # 人力资源模块
openlark-ai = { workspace = true, optional = true }   # AI服务模块
# openlark-mail = { workspace = true, optional = true } # 暂时注释，未加入workspace

[features]
default = ["communication"]  # auth 始终启用，无需包含在默认功能中

# Core client feature
client = []

# Auth service (always enabled, but kept for feature flag compatibility)
auth = []

# WebSocket support
websocket = ["tokio-tungstenite", "futures-util", "lark-websocket-protobuf", "url", "prost", "reqwest", "log"]

# P0 阶段 1 业务服务功能
# auth 现在默认启用，不再需要功能标志
communication = ["openlark-communication"]    # 通讯和消息
docs = ["openlark-docs"]                    # 文档和知识库
security = ["openlark-security"]              # 安全认证

# P0.5 Phase 2 business service features
hr = ["openlark-hr"]                    # 人力资源
ai = ["openlark-ai"]                     # AI服务

# Additional business services
bitable = ["openlark-docs"]            # 多维表格
calendar = []                          # 日历会议
admin = []                             # 管理功能
approval = []                          # 审批流程
helpdesk = []                          # 帮助台
mail = []                              # 邮件服务
application = []                       # 应用服务
meeting = []                           # 会议服务

# Legacy features for backward compatibility (暂时保留，用于解决代码中的cfg引用)
collab = []                             # 协作功能（集成到其他模块中）
people = []                             # 人员管理（集成到其他模块中）
hire = []                               # 招聘管理（集成到其他模块中）

# P0 3-layer architecture features
core-layer = [
    "communication",  # IM、消息、联系人管理
    "docs",           # 云文档、表格、知识库
    "security",       # 安全认证
]

# Convenience features - P0模块组合
p0-services = [
    "communication", "docs", "security"
]

# Complete client features for easy selection
client-communication = ["client", "communication"]
client-docs = ["client", "docs"]
client-security = ["client", "security"]
client-p0 = ["client", "p0-services"]

[dev-dependencies]
tokio-test = "0.4"
wiremock = { workspace = true }
rstest = { workspace = true }
tempfile = { workspace = true }
mockall = { workspace = true }