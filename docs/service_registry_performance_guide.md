# ServiceRegistry æ€§èƒ½åŸºå‡†æµ‹è¯•æŒ‡å—

## æ¦‚è¿°

ServiceRegistryæ€§èƒ½åŸºå‡†æµ‹è¯•æ¡†æ¶æä¾›äº†å…¨é¢çš„æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œç”¨äºéªŒè¯æœåŠ¡æ³¨å†Œè¡¨åœ¨å„ç§è´Ÿè½½æ¡ä»¶ä¸‹çš„è¡¨ç°ã€‚è¯¥æ¡†æ¶åŒ…å«è‡ªåŠ¨åŒ–åŸºå‡†æµ‹è¯•ã€æ€§èƒ½åˆ†æå’Œä¼˜åŒ–å»ºè®®åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒæµ‹è¯•é¡¹ç›®

1. **æœåŠ¡æ³¨å†Œæ€§èƒ½æµ‹è¯•** - æµ‹è¯•å‘ServiceRegistryæ³¨å†Œæ–°æœåŠ¡çš„æ€§èƒ½
2. **æœåŠ¡æ£€ç´¢æ€§èƒ½æµ‹è¯•** - æµ‹è¯•ä»ServiceRegistryè·å–å·²æ³¨å†ŒæœåŠ¡çš„æ€§èƒ½
3. **æœåŠ¡å‘ç°æ€§èƒ½æµ‹è¯•** - æµ‹è¯•åˆ—å‡ºæ‰€æœ‰å·²æ³¨å†ŒæœåŠ¡çš„æ€§èƒ½
4. **å¹¶å‘è®¿é—®æ€§èƒ½æµ‹è¯•** - æµ‹è¯•å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ServiceRegistryçš„æ€§èƒ½

### ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å¹³å‡å“åº”æ—¶é—´** (å¾®ç§’çº§ç²¾åº¦)
- **æœ€å°/æœ€å¤§å“åº”æ—¶é—´**
- **æ¯ç§’æ“ä½œæ•°** (OPS)
- **å†…å­˜ä½¿ç”¨é‡** (å¯é€‰)
- **å¹¶å‘æ€§èƒ½åˆ†æ**

## ä½¿ç”¨æ–¹æ³•

### 1. è¿è¡Œå†…ç½®åŸºå‡†æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•ï¼ˆé»˜è®¤å¯ç”¨æ‰€æœ‰æ ¸å¿ƒæœåŠ¡ï¼‰
cargo test --features "authentication,im,contact,search" test_benchmark_suite

# è¿è¡Œç‰¹å®šåŠŸèƒ½çš„åŸºå‡†æµ‹è¯•
cargo test --features "im" test_benchmark_suite
```

### 2. ä½¿ç”¨ç‹¬ç«‹åŸºå‡†æµ‹è¯•ç¨‹åº

```bash
# è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•å¥—ä»¶
cargo run --example service_registry_benchmark --features "authentication,im,contact,search"

# è¿è¡Œç‰¹å®šæœåŠ¡ç»„åˆçš„åŸºå‡†æµ‹è¯•
cargo run --example service_registry_benchmark --features "im,contact"
```

### 3. åœ¨ä»£ç ä¸­ä½¿ç”¨åŸºå‡†æµ‹è¯•æ¡†æ¶

```rust
use open_lark::service_registry::benchmark::BenchmarkSuite;
use open_lark::core::config::{Config, ConfigBuilder};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆ›å»ºåŸºå‡†æµ‹è¯•å¥—ä»¶
    let suite = BenchmarkSuite::new();

    // è®¾ç½®æ ¸å¿ƒæœåŠ¡
    suite.setup_core_services()?;

    // è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•å¥—ä»¶
    let results = suite.run_full_benchmark_suite().await;

    // åˆ†æç»“æœ
    for result in results {
        result.print();
        result.validate_performance(1000)?; // 1å¾®ç§’æ€§èƒ½è¦æ±‚
    }

    Ok(())
}
```

## æ€§èƒ½åŸºå‡†

### ğŸ¯ æ¨èæ€§èƒ½æŒ‡æ ‡

| æµ‹è¯•é¡¹ç›® | ç›®æ ‡æ€§èƒ½ | å¯æ¥å—æ€§èƒ½ | éœ€è¦ä¼˜åŒ– |
|---------|---------|-----------|---------|
| æœåŠ¡æ³¨å†Œ | < 100Î¼s | < 500Î¼s | > 500Î¼s |
| æœåŠ¡æ£€ç´¢ | < 1Î¼s | < 5Î¼s | > 5Î¼s |
| æœåŠ¡å‘ç° | < 5Î¼s | < 20Î¼s | > 20Î¼s |
| å¹¶å‘è®¿é—® | < 2Î¼s | < 10Î¼s | > 10Î¼s |

### ğŸ“ˆ æ€§èƒ½ç­‰çº§è¯´æ˜

- **âœ… ä¼˜ç§€**: æ€§èƒ½æ˜¾è‘—ä¼˜äºæ¨èæŒ‡æ ‡
- **ğŸŸ¡ è‰¯å¥½**: æ€§èƒ½åœ¨å¯æ¥å—èŒƒå›´å†…
- **âš ï¸ éœ€è¦ä¼˜åŒ–**: æ€§èƒ½ä½äºå¯æ¥å—æ ‡å‡†

## æµ‹è¯•ç»“æœè§£è¯»

### åŸºå‡†æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
ğŸ“Š æœåŠ¡æ£€ç´¢æ€§èƒ½åŸºå‡†æµ‹è¯•
  è¿­ä»£æ¬¡æ•°: 10000
  æ€»è€—æ—¶: 8.5ms
  å¹³å‡è€—æ—¶: 850 ns (0.85 Î¼s)
  æœ€å°è€—æ—¶: 750 ns
  æœ€å¤§è€—æ—¶: 1200 ns
  æ¯ç§’æ“ä½œæ•°: 1176470
```

### å…³é”®æŒ‡æ ‡å«ä¹‰

- **å¹³å‡è€—æ—¶**: å•æ¬¡æ“ä½œçš„å¹³å‡æ—¶é—´ï¼Œè¶Šä½è¶Šå¥½
- **æ¯ç§’æ“ä½œæ•°**: æ¯ç§’èƒ½å®Œæˆçš„æ“ä½œæ•°é‡ï¼Œè¶Šé«˜è¶Šå¥½
- **æœ€å°/æœ€å¤§è€—æ—¶**: æ€§èƒ½æ³¢åŠ¨èŒƒå›´ï¼Œè¶Šå°è¶Šç¨³å®š

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æœåŠ¡æ³¨å†Œä¼˜åŒ–

- é¿å…é¢‘ç¹æ³¨å†Œ/æ³¨é”€æœåŠ¡
- ä½¿ç”¨æœåŠ¡æ± é¢„æ³¨å†Œå¸¸ç”¨æœåŠ¡
- è€ƒè™‘æ‰¹é‡æ³¨å†Œå¤šä¸ªç›¸å…³æœåŠ¡

### 2. æœåŠ¡æ£€ç´¢ä¼˜åŒ–

- ç¼“å­˜é¢‘ç¹è®¿é—®çš„æœåŠ¡å¼•ç”¨
- ä½¿ç”¨ç±»å‹å®‰å…¨çš„æœåŠ¡è·å–æ–¹æ³•
- é¿å…åœ¨çƒ­è·¯å¾„ä¸­åŠ¨æ€æŸ¥æ‰¾æœåŠ¡

### 3. å¹¶å‘è®¿é—®ä¼˜åŒ–

- åˆç†è®¾ç½®å¹¶å‘çº§åˆ«
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†å¹¶å‘è¯·æ±‚
- ç›‘æ§å¹¶å‘è®¿é—®çš„æ€§èƒ½å½±å“

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰åŸºå‡†æµ‹è¯•

```rust
use open_lark::service_registry::benchmark::{BenchmarkSuite, BenchmarkResult};
use std::time::Duration;

// åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•
let suite = BenchmarkSuite::new();
let result = suite.benchmark_service_retrieval(1000);

// éªŒè¯æ€§èƒ½è¦æ±‚
match result.validate_performance(1000) {
    Ok(()) => println!("âœ… æ€§èƒ½è¾¾æ ‡"),
    Err(msg) => println!("âš ï¸ æ€§èƒ½é—®é¢˜: {}", msg),
}
```

### å†…å­˜ä½¿ç”¨åˆ†æ

```rust
// å¯ç”¨å†…å­˜ç›‘æ§
let suite = BenchmarkSuite::new();
let mut results = suite.run_full_benchmark_suite().await;

// æ·»åŠ å†…å­˜ä½¿ç”¨ä¿¡æ¯
for result in &mut results {
    let memory = get_memory_usage(); // è‡ªå®šä¹‰å†…å­˜è·å–å‡½æ•°
    *result = result.clone().with_memory_usage(memory);
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•ç»“æœä¸ç¨³å®š**
   - ç¡®ä¿æµ‹è¯•ç¯å¢ƒç¨³å®š
   - å¢åŠ æµ‹è¯•è¿­ä»£æ¬¡æ•°
   - æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½æƒ…å†µ

2. **æ€§èƒ½æŒ‡æ ‡å¼‚å¸¸**
   - éªŒè¯åŠŸèƒ½æ ‡å¿—æ­£ç¡®å¯ç”¨
   - æ£€æŸ¥æœåŠ¡é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æµ‹è¯•æ•°æ®é‡åˆé€‚

3. **ç¼–è¯‘é”™è¯¯**
   - ç¡®ä¿å¯ç”¨äº†å¿…è¦çš„åŠŸèƒ½æ ‡å¿—
   - æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§
   - éªŒè¯Rustå·¥å…·é“¾ç‰ˆæœ¬

### è°ƒè¯•æŠ€å·§

```rust
// å¯ç”¨è¯¦ç»†æ—¥å¿—
RUST_LOG=debug cargo test --features "im" test_benchmark_suite

// è¿è¡Œå•ä¸ªåŸºå‡†æµ‹è¯•
cargo test --features "im" benchmark_service_retrieval

// æ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡
cargo test --features "im" test_benchmark_suite -- --nocapture
```

## æŒç»­é›†æˆ

### CI/CDé›†æˆç¤ºä¾‹

```yaml
# .github/workflows/performance.yml
name: Performance Tests
on: [push, pull_request]

jobs:
  benchmark:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable

      - name: Run performance benchmarks
        run: |
          cargo test --features "authentication,im,contact,search" test_benchmark_suite

      - name: Run benchmark example
        run: |
          cargo run --example service_registry_benchmark --features "authentication,im,contact,search"
```

## æ€§èƒ½ç›‘æ§

### ç”Ÿäº§ç¯å¢ƒç›‘æ§å»ºè®®

1. **è®¾ç½®æ€§èƒ½å‘Šè­¦**
   - ç›‘æ§å¹³å‡å“åº”æ—¶é—´
   - è®¾ç½®æ€§èƒ½é˜ˆå€¼å‘Šè­¦
   - è·Ÿè¸ªæ€§èƒ½è¶‹åŠ¿å˜åŒ–

2. **å®šæœŸæ€§èƒ½è¯„ä¼°**
   - æ¯å‘¨è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•
   - å¯¹æ¯”å†å²æ€§èƒ½æ•°æ®
   - åˆ†ææ€§èƒ½å›å½’é—®é¢˜

3. **æ€§èƒ½ä¼˜åŒ–å¾ªç¯**
   - è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
   - å®æ–½ä¼˜åŒ–æªæ–½
   - éªŒè¯ä¼˜åŒ–æ•ˆæœ
   - æŒç»­ç›‘æ§æ”¹è¿›

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¶é—´**: 2025-11-04
**ç»´æŠ¤è€…**: Open-Lark å¼€å‘å›¢é˜Ÿ
**æ›´æ–°é¢‘ç‡**: æ ¹æ®åŠŸèƒ½æ›´æ–°åŠæ—¶è°ƒæ•´